/***********************************************************************************************************
 ********************************************* Included files **********************************************
 ***********************************************************************************************************/

#include "tim.h"
#include "app_can.h"
#include "app_light.h"
#include "app_imu.h"

/***********************************************************************************************************
 ************************************************* Defines *************************************************
 ***********************************************************************************************************/

/***********************************************************************************************************
 *********************************************** Data types ************************************************
 ***********************************************************************************************************/

/***********************************************************************************************************
 **************************************** Local function prototypes ****************************************
 ***********************************************************************************************************/

/***********************************************************************************************************
 ******************************************** Exported objects *********************************************
 ***********************************************************************************************************/

/***********************************************************************************************************
 ********************************************* Local objects ***********************************************
 ***********************************************************************************************************/

/***********************************************************************************************************
 ******************************************* Exported functions ********************************************
 ***********************************************************************************************************/

void AppSystem_Init(void)
{
	/* Enable TIM6 - task scheduler */
	HAL_TIM_Base_Start_IT(&htim6);
}

void AppSystem_MainTask(void)
{
	static uint32_t counter;

	// Process CAN transmission every 100ms
	AppCan_Task();

	// Process light conversion every 400ms
	if((counter % 4) == 0U)
	{
		AppLight_Task();
	}

	// Process imu conversion every 700ms
	if((counter % 7) == 0U)
	{
		AppImu_Task();
	}

	counter++;
}

/***********************************************************************************************************
 ******************************************** Local functions **********************************************
 ***********************************************************************************************************/
