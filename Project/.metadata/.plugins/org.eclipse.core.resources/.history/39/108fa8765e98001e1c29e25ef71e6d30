/***********************************************************************************************************
 ********************************************* Included files **********************************************
 ***********************************************************************************************************/

#include <stdint.h>
#include "app_can.h"
#include "lsm6dso.h"
#include "lsm6dso_com.h"

/***********************************************************************************************************
 ************************************************* Defines *************************************************
 ***********************************************************************************************************/

#define APP_IMU_DATA_SIZE  (6U)

/***********************************************************************************************************
 *********************************************** Data types ************************************************
 ***********************************************************************************************************/

/***********************************************************************************************************
 **************************************** Local function prototypes ****************************************
 ***********************************************************************************************************/

/***********************************************************************************************************
 ******************************************** Exported objects *********************************************
 ***********************************************************************************************************/

/***********************************************************************************************************
 ********************************************* Local objects ***********************************************
 ***********************************************************************************************************/

static uint8_t AppImu_Data[APP_IMU_DATA_SIZE];

/***********************************************************************************************************
 ******************************************* Exported functions ********************************************
 ***********************************************************************************************************/

void AppImu_Init(void)
{
    LSM6DSO_Init();
}

void AppImu_Task(void)
{
    uint8_t status;
    LSM6DSO_Result_t results;

    status = LSM6DSO_SingleRead(LSM6DSO_REG_STATUS_REG);

    if(status & LSM6DSO_XLDA)
    {
        LSM6DSO_ReadAcceleration();
    }

    if(status & LSM6DSO_GDA)
    {
        LSM6DSO_ReadAngularRate();
    }

    if(status & LSM6DSO_TDA)
    {
        LSM6DSO_ReadTemperature();
    }

    LSM6DSO_GetResults(&results);

    AppImu_Data[0U] = (uint8_t)(results.angular_rate.x & 0xFF);
    AppImu_Data[1U] = (uint8_t)((results.angular_rate.x >> 8U) & 0xFF);
    AppImu_Data[2U] = (uint8_t)(results.angular_rate.y & 0xFF);
    AppImu_Data[3U] = (uint8_t)((results.angular_rate.y >> 8U) & 0xFF);
    AppImu_Data[4U] = (uint8_t)(results.angular_rate.z & 0xFF);
    AppImu_Data[5U] = (uint8_t)((results.angular_rate.z >> 8U) & 0xFF);

    AppCan_FillFrame(AppCanFrame1_Gyro, AppImu_Data);

    AppImu_Data[0U] = (uint8_t)(results.acceleration.x & 0xFF);
    AppImu_Data[1U] = (uint8_t)((results.acceleration.x >> 8U) & 0xFF);
    AppImu_Data[2U] = (uint8_t)(results.acceleration.y & 0xFF);
    AppImu_Data[3U] = (uint8_t)((results.acceleration.y >> 8U) & 0xFF);
    AppImu_Data[4U] = (uint8_t)(results.acceleration.z & 0xFF);
    AppImu_Data[5U] = (uint8_t)((results.acceleration.z >> 8U) & 0xFF);

    AppCan_FillFrame(AppCanFrame2_Acc, AppImu_Data);

    AppImu_Data[0U] = (uint8_t)(results.temperature.x & 0xFF);
    AppImu_Data[1U] = (uint8_t)((results.temperature.x >> 8U) & 0xFF);
    AppCan_FillFrame(AppCanFrame3_Temp, AppImu_Data);
}

/***********************************************************************************************************
 ******************************************** Local functions **********************************************
 ***********************************************************************************************************/




